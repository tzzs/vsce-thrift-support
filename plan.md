# Thrift Language Support - 计划与进度

**当前版本**: 1.0.19

**最新状态**: ✅ `npm run test` 全量通过（219 passing）

本文档聚焦当前版本可执行的工作项与进度，按「概览 → 近期 → 中期 → 长期 → 已完成」结构组织。

---

## 0. 概览

- **主要目标**: 稳定增量格式化、持续提升测试与质量保障
- **当前重点**: 回归稳定、增量格式化边界正确性

---

## 1. 近期目标（P0 / 1-2 个月）

### 1.1 增量格式化稳定性

- [x] 修复范围格式化从 struct header 起始时的额外缩进问题
- [x] 添加回归测试（增量范围起点在 struct header）
- [ ] 补充与 range formatting 相关的边界用例（空行开头、block comment 前置）

### 1.2 测试与验证

- [x] 全量测试通过（`npm run test`）
- [x] 覆盖率脚本稳定性修复（见 2.1）

---

## 2. 中期规划（P1 / 3-6 个月）

### 2.1 覆盖率脚本修复（✅ 已完成）

**状态**: `npm run coverage` 已改为 `nyc --reporter=text-summary mocha`，避免 Mocha 全局未注入问题。
- [x] 覆盖率脚本改为使用 Mocha
- [ ] CI 加入覆盖率任务，失败阻断合并

### 2.2 LSP 化与增量索引（规划中）

- [ ] 拆分 UI/语言服务层
- [ ] 诊断/符号/引用迁移到 LSP
- [ ] 索引缓存与 dirtyRange 更新策略

---

## 3. 长期方向（P2 / 6-12 个月）

- [ ] 高级编辑功能（Call Hierarchy/Type Hierarchy/Refactor）
- [ ] 语义诊断与 Quick Fix 扩展
- [ ] 性能基准与大型仓库压力测试

---

## 4. 已完成归档（近期）

- ✅ Mocha 测试框架迁移完成
- ✅ 测试用例全面修复与统一 mock 机制
- ✅ 增量格式化范围起点导致的额外缩进问题修复
- ✅ 增量格式化新增回归测试用例
- ✅ 覆盖率脚本改为 Mocha 运行

---

## 5. 版本与记录

| 版本   | 主要更新 |
|--------|----------|
| 1.0.19 | 增量格式化缩进修复与回归测试；覆盖率脚本修复；全量测试通过 |
| 1.0.13 | Mocha 测试迁移与 formatter/diagnostics 相关修复 |
| 1.0.12 | AST/Parser 重构，增量分析/格式化与性能优化 |

---

## 6. 贡献与验证要求

- 提交前运行 `npm run lint` 与 `npm run test`
- 遵循 Conventional Commits 规范
- 关键修复需包含最小回归测试
